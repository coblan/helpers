{% extends "f7/wraper.html" %}
{% load static %}
{% load jsonify %}


{% block extra_script %}
<!--<div>-->
<!--<a href="/_f7_frame?name=iframe_sss&src=/wx/home.wx" class="item-link">sss</a>-->
<!--<a href="/_f7_frame?name=iframe_worklist&src=/wx/work.worklist.wx" class="item-link">worklist</a>-->


<!--</div>-->

<link rel="stylesheet" href="{% static 'lib/weui.min.css' %}">
<script src="{% static 'lib/jquery3.2.1.min.js' %}"></script>
<link rel="stylesheet" href="{% static 'lib/font-awesome4.7/font-awesome4.7.min.css' %}">
<script src="{% static 'lib/vue2.3.2.js' %}"></script>
<script src="{% static 'js/fields_mb.pack.js' %}"></script>
<script type="text/javascript">
    function set_title(title){
        $('.navbar-on-center .center').html(title)
    }
    function iframe_load(url,name){
        var iframe_url='/_f7_iframe?name=iframe_'+name+'&src='+encodeURIComponent(url)
        mainView.router.loadPage(iframe_url)
    }
    function replace_iframe(str){
        var iframe=$('.page-on-center .iframe_wraper')

        var container = iframe.parent();
//
        iframe.remove();
        iframe.attr('data', str);
        container.append(iframe);
        history.pushState({kind:'replace_url'},'')

//        $('.page-on-center iframe')[0].contentWindow.location.replace(str)
    }
    function pop_menu(callback){
        $('.navbar-on-center .pop-menu').css('visibility','visible')
        if(callback){
            $('.navbar-on-center .pop-menu').click(callback)
        }
    }
    function back(callback){
        if(callback){
            callback($('.page-on-left .iframe_wraper')[0].contentWindow)
        }
        mainView.router.back()

//        setTimeout(function(){
//            $('.page-on-center iframe')[0].contentWindow.location.reload()
//        },500)
    }
    function iframe_full_screen(value,second){
        var second= second || 300
        if(value){
            $('.page-on-center .iframe_wraper').addClass('full-screen')
            $('.toolbar').hide()
            setTimeout(function(){
                $('.navbar').hide()
            },second)

        }else{
            $('.page-on-center .iframe_wraper').removeClass('full-screen')
            $('.page-on-center .page-content').addClass('_no_bottom')
            $('.navbar').show()
            setTimeout(function(){
                $('.toolbar').show()
                $('.page-on-center .page-content').removeClass('_no_bottom')
            },second)


        }
    }
    function call_iframe(callback_name){
        var args=Array.prototype.slice.call(arguments)
        $('.page-on-center .iframe_wraper')[0].contentWindow[callback_name].apply(this,args.slice(1,args.length))
    }
    function add_nav(str){
        $('.navbar-on-center').after(str)
    }
    function remove_nav(){
        $('.navbar-on-center').next('.navbar').remove()
    }

    function pushState(state){
        if(JSON.stringify(history.state)!=JSON.stringify(state)){
            ln.pushState(state)
        }

    }


    ln.history_handle({
//        init:{viewIndex:0},
        handler:function(state){
            if(state.pathname  && state.pathname == location.pathname){
                mainView.router.back()
            }else if(state.call_iframe){
                call_iframe(state.call_iframe,state)
            }else{
                mainView.router.back()
            }
            // 如果 mainView.history 没有了，还在 back，证明想退出
        }
    })
    menu = {{ menu | jsonify }}

    title_bar=false

        $(function(){
            new Vue({
                el:'#there',
                data:{
                    menu:menu,

                },

                methods:{
                }
            })
        })
</script>

<style type="text/css">
    .pad{
        background-color: white;
        margin-top: 20px;
    }
    .nav .fake-active>i,.nav .fake-active>p{
        color: green;

    }
     p.weui-tabbar__label{
         margin: 0.2em;
     }
     .page-content{
         z-index: auto;
     }
    /*.iframe-content{*/
        /*width: 100%;*/
        /*height: 100%;*/
    /*}*/
    .page-content._no_bottom{
        padding-bottom: 0;
    }
    .iframe_wraper.full-screen{
        position: fixed;
        top:0;
        left:0;
        bottom: 0;
        right: 0;
        z-index: 5000;
        margin: 0;
        padding: 0;
    }
</style>



{% endblock %}

{% block page_content %}


<div id="there">

    <div class="b-image">
    <img src="http://thumb.jfcdns.com/thumb/up/2015-2/201502041009207922590_225_260.jpg" width="100%"/>

    </div>


    <div class="pad">
    <div class="weui-grids">
        <a :href="'/_f7_iframe?name=iframe_'+act.name+'&src='+act.url" class="weui-grid ajax" v-for="act in menu">
            <div class="weui-grid__icon">
                <span v-html="act.icon"></span>
            </div>
            <p class="weui-grid__label" v-text="act.label"></p>
        </a>
    </div>
    </div>


</div>


{% endblock %}

{% block tool_bar %}

<div class="toolbar">
    <div class="weui-tabbar nav footer">
        <a id="help-page" href="/f7/help.f7" class="weui-tabbar__item external">
            <i class="fa fa-info-circle weui-tabbar__icon" aria-hidden="true" ></i>
            <p class="weui-tabbar__label">信息</p>
        </a>
        <a id="work-panel" href="/f7/home.f7" class="weui-tabbar__item weui-bar__item_on external">
            <i class="fa fa-th weui-tabbar__icon" aria-hidden="true" ></i>
            <p class="weui-tabbar__label">工作</p>
        </a>
        <a id="employee-center" href="/f7/organize.employeeself.f7" class="weui-tabbar__item external">
            <i class="fa fa-user-circle weui-tabbar__icon" aria-hidden="true" ></i>
            <p class="weui-tabbar__label">我的信息</p>
        </a>

    </div>
 </div>
{% endblock %}

