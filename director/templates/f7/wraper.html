<!DOCTYPE html>
{% load static %}
{% load jsonify %}

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>My App</title>
    <script src="{% static 'lib/jquery3.2.1.min.js' %}"></script>
    <!-- Path to Framework7 Library CSS-->
    <link rel="stylesheet" href="/static/lib/framework7/framework7.ios.min.css">
    <link rel="stylesheet" href="/static/lib/framework7/framework7.ios.colors.min.css">
    <!-- Path to your custom app styles-->
    <!--<link rel="stylesheet" href="css/my-app.css">-->
    <script src='{% static "js/exfun.js?t="%}{{ stamp.exfun_js }}'></script>
</head>

{% include 'director/reverse.html' %}

{% block extra_script %}

{% endblock %}

<body class="start">
<!-- Status bar overlay for fullscreen mode-->
<div class="statusbar-overlay"></div>
<!-- Panels overlay-->
<div class="panel-overlay"></div>
<!-- Left panel with reveal effect-->
<div class="panel panel-left panel-reveal">
    <div class="content-block">
        <p>Left panel content goes here</p>
    </div>
</div>
<!-- Right panel with cover effect-->
<div class="panel panel-right panel-cover">
    <div class="content-block">
        <p>Right panel content goes here</p>
    </div>
</div>
<!-- Views-->
<div class="views">
    <!-- Your main view, should have "view-main" class-->
    <div class="view view-main">
        <!-- Top Navbar-->
        <div class="navbar">
            <div class="navbar-inner">
                <!-- We have home navbar without left link-->
                <div class="center">演示APP</div>
                <div class="right">
                    <!--<a href="#" class="link icon-only open-panel"> <i class="icon icon-bars"></i></a>-->
                </div>
            </div>
        </div>
        <!-- Pages, because we need fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages navbar-through toolbar-through">
            <!-- Page, data-page contains page name-->
            <div data-page="home" class="page">
                <!-- Scrollable page content-->
                <div class="page-content">
                    {% block page_content %}
                    <a href="/static/services.html?t=123">service</a>
                    {% endblock %}
                </div>

                {% block tool_bar %}
                <div class="toolbar">
                    <div class="toolbar-inner"><a href="#" class="link">Link 1</a><a href="#" class="link">Link 2</a></div>
                </div>
                {% endblock %}

            </div>
        </div>
        <!-- Bottom Toolbar-->


    </div>
</div>
<!-- Path to Framework7 Library JS-->
<script type="text/javascript" src="/static/lib/framework7/framework7.min.js"></script>

<!--<style>-->
    <!--.popup-overlay{z-index: 111 !important;}-->
<!--</style>-->
<style type="text/css">
    .pad{
        background-color: white;
        margin-top: 20px;
    }
    .nav .fake-active>i,.nav .fake-active>p{
        color: green;

    }
    p.weui-tabbar__label{
        margin: 0.2em;
    }
    .page-content{
        z-index: auto;
    }

    .page-content._no_bottom{
        padding-bottom: 0;
    }
    .iframe_wraper.full-screen{
        position: fixed;
        top:0;
        left:0;
        bottom: 0;
        right: 0;
        z-index: 5000;
        margin: 0;
        padding: 0;
    }
</style>

<script>
    function set_title(title){
        $('.navbar-on-center .center').html(title)
    }
    function load_iframe(url,name){
        var iframe_url='/_f7_iframe?name=iframe_'+name+'&src='+encodeURIComponent(url)
        mainView.router.loadPage(iframe_url)
    }
    function replace_iframe(str){
        var page_name=$('.page-on-center').attr('data-page')
        var iframe=$('.page-on-center .iframe_wraper')

        var html = '<iframe class="iframe_wraper" src='+str + ' frameborder="0" width="100%" height="100%" src="/f7/work.wkself.f7"></iframe>'
        iframe.after(html)
        iframe.remove();
        history.replaceState({name:page_name,kind:'page'}, '');

    }
    function pop_menu(callback){
        $('.view .navbar .navbar-inner:last-child .pop-menu').css('visibility','visible')
        if(callback){
            $('.view .navbar .navbar-inner:last-child .pop-menu')[0].onclick=callback
        }
//        $('.navbar-on-center .pop-menu').css('visibility','visible')
//        if(callback){
//            $('.navbar-on-center .pop-menu')[0].onclick=callback
//        }
    }
    function back(callback){
        if(callback){
            var last_win= $(mainView.activePage.fromPage.container).find('.iframe_wraper')[0].contentWindow
            callback(last_win)
        }
        mainView.router.back()
    }
    function iframe_full_screen(value,second){
        var second= second || 300
        if(value){
            $('.page-on-center .iframe_wraper').addClass('full-screen')
            $('.toolbar').hide()
            setTimeout(function(){
                $('.navbar').hide()
            },second)

        }else{
            $('.page-on-center .iframe_wraper').removeClass('full-screen')
            $('.page-on-center .page-content').addClass('_no_bottom')
            $('.navbar').show()
            setTimeout(function(){
                $('.toolbar').show()
                $('.page-on-center .page-content').removeClass('_no_bottom')
            },second)
        }
    }

    function show_toolbar(){
        $('.page-content').removeClass('_no_bottom')
        $('.toolbar').show()
    }
    function hide_toolbar(){
        $('.toolbar').hide()
        $('.page-content').addClass('_no_bottom')

    }

    function call_iframe(callback_name){
        var args=Array.prototype.slice.call(arguments)
        $('.page-on-center .iframe_wraper')[0].contentWindow[callback_name].apply(this,args.slice(1,args.length))
    }
    function add_nav(str){
        $('.view .navbar .navbar-inner:last-child').after(str)
    }
    function remove_nav(){
        $('.view .navbar .navbar-inner:last-child').remove()
    }

    function init_page(){
        state_stack=[]
        add_history()
    }

    function add_history(){
        for(var i=0;i<3;i++){
            history.pushState({count:i},'')
        }
    }

    add_history()

    window.addEventListener('popstate', function (e) {
        var state= e.state
        if(state.count<1){
            add_history()
        }
        if(state_stack.length<=0){
            mainView.router.back()
        }else{
            var real_state= state_stack.pop()
            if(typeof(real_state) === 'function'){
                real_state()
            }
        }
        hide_load()

    }, false);

//    ln.history_handle({
////        init:{viewIndex:0},
//        handler:function(state){
//            if(state.count<1){
//                add_history()
//            }
//            if(state_stack.length<=0){
//                mainView.router.back()
//            }else{
//                var real_state= state_stack.pop()
//                if(typeof(real_state) === 'function'){
//                    real_state()
//                }
//            }
//            hide_load()
//        }
//    })
</script>


<div class="_full_wraper hide general-loader">
    <div class="general">
        <span style="width:42px; height:42px" class="preloader"></span>
    </div>
</div>

<script>
    $(function(){
        setTimeout(function(){
            $('body').removeClass('start')
            $('body').addClass('ready')
        })
    })
</script>

<style>
    body.start{
        opacity: 0;
    }
    body.ready{
        background-color: #f7f5f3;
        transition: all 0.2s ease;
    }

    ._full_wraper{
        position: fixed;
        top:0;
        left:0;
        right:0;
        bottom: 0;
        z-index:5000;
    }
    .hide{
        display: none;
    }
    .general-loader .general{
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%,-50%);
    }
    iframe { display: block; }
</style>

<script>
    var load_timer=null

    function show_load(timeout){
        var timeout= timeout || 10*1000
        $('.general-loader').removeClass('hide')

        if(load_timer){
            clearTimeout(load_timer)
        }
        load_timer =setTimeout(function(){
            myApp.alert('请检查网络问题', '加载超时');
            hide_load()
        },timeout)
    }
    function hide_load(time){
        if(load_timer){
            clearTimeout(load_timer)
            load_timer=null
        }
        var time= time || 20
        setTimeout(function(){
            $('.general-loader').addClass('hide')
        },time)
    }

</script>

<script>

    var myApp = new Framework7({
        modalTitle:'信息提示',
        modalButtonOk:'好的',
        modalButtonCancel:'不了',


//        pushState:true,
//        swipeBackPage:true,
    });
    var $$ = Dom7;

    // Add view
    var mainView = myApp.addView('.view-main', {
        // Because we use fixed-through navbar we can enable dynamic navbar
        dynamicNavbar: true,

    });


    function on_page_switch(page){
//        if(page.name=='home'){
//            show_toolbar()
//        }else{
//            hide_toolbar()
//        }
    }

    myApp.onPageAfterBack('*', function(page){

        on_page_switch(page.view.activePage)
    })

    $$(document).on('pageInit', function (e) {

        // Get page data from event data
        var page = e.detail.page;
        state_stack=[]

        if($('.page-on-right').attr('data-page')== page.name){
            on_page_switch(page)
        }


        if (page.name.startsWith('iframe_')) {

            $(page.view.activePage.container).find('.page-content').addClass('_no_bottom')

            setTimeout(function(){
                var el=$('.page-on-center').find('.iframe_wraper')
                var data = el.attr('data-src')
                el.attr('src',data)
                show_load(10*1000)
            },500)
        }else if(page.name=='home'){
            new Vue({
                el:'#there',
                data:{
                    menu:menu,

                },
                methods:{
                }
            })
        }
    })
</script>
</body>
</html>