<!doctype html>
{% load static %}
{% load jsonify %}
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
    <title>{{ page_label | default:''}}</title>


    <script src="{% static 'lib/jquery3.2.1.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'lib/font-awesome4.7/font-awesome4.7.min.css' %}">
    <script src="{% static 'lib/vue2.3.2.js' %}"></script>
    <link rel="stylesheet" href="{% static 'lib/bootstrap.min.css' %}">


    <link rel="stylesheet" href="{% static 'lib/weui.min.css' %}">
    <!--<script src="{% static 'lib/weui.min.js' %}"></script>-->

    <script src='{% static "js/i18n.js" %}'></script>
    <script src='{% static "js/exfun.js?t="%}{{ stamp.exfun_js }}'></script>

    <script src="{% static 'js/uis_mb.pack.js?t=' %}{{ stamp.uis_mb_pack_js }}"></script>
    <script src="{% static 'js/fields_mb.pack.js?t=' %}{{ stamp.fields_mb_pack_js}}"></script>
    <script src="{% static 'js/table_mb.pack.js?t=' %}{{ stamp.table_mb_pack_js }}"></script>
    <!--<script src="{% static 'js/wave.js?t=' %}{{ stamp.table_mb_pack_js }}"></script>-->
    <script src="{% static 'lib/moment2.17.1.min.js' %}"></script>

    <script src="{% static 'apps/director.pack.js' %}"></script>
    {% include 'director/reverse.html' %}

    <script>

//        function sleep(milliseconds) {
//            var start = new Date().getTime();
//            for (var i = 0; i < 1e7; i++) {
//                if ((new Date().getTime() - start) > milliseconds){
//                    break;
//                }
//            }
//        }
//
//        if(parent.myApp){
//            while(!parent.load_animation_over){
//                sleep(100)
//            }
//        }

//        ff={
//            app:parent.myApp,
//            push:function(obj){
//                parent.state_stack.push(obj)
//            },
//            pop:function(){
//                parent.state_stack.pop()
//            },
//            back:function(callback){
//                parent.back(callback)
//            },
//            load:function(url,name){
//                var name=name.replace(/\./g,'_')
//                parent.show_load()
//                parent.load_iframe(url,name)
//            },
//            replace:function(url){
//                parent.show_load()
//                parent.replace_iframe(url)
//            },
//            pop_menu:function(buttons){
//                parent.pop_menu(buttons)
//            },
//            show_load:function(){
//                parent.show_load()
//            },
//            hide_load:function(time){
//                parent.hide_load(time)
//            },
//            init_page:function(str){
//                ff.hide_load(200)
//                var str= str || page_label
//                parent.init_page()
//                parent.set_title(str)
//            },
//            show_nav:function(){
//                parent.show_nav()
//            },
//            hide_nav:function(){
//              parent.hide_nav()
//            },
//            add_nav:function(str){
//                parent.add_nav(str)
//            },
//            alert:function(str){
//                parent.myApp.alert(str)
//            },
//            confirm:function(info,callback){
//                parent.myApp.confirm(info, callback);
//            },
//            open_image:function(str){
//                var myPhotoBrowser = parent.myApp.photoBrowser({
//                    zoom: 400,
//                    photos: [str]
//                });
//                myPhotoBrowser.open(); // open photo browser
//                ff.push(function(){
//                    myPhotoBrowser.close()
//                })
//            }
//
//        }
//
//        if(!parent.myApp){
//            ff={
//                app:{
//                    actions:function(){
//
//                    }
//                },
//                push:function(obj){
//                },
//                pop:function(){
//                },
//                back:function(callback){
//                },
//                load:function(url,name){
//                    location=url
//                },
//                replace:function(url){
//                    location=url
//                },
//                pop_menu:function(buttons){
//
//                },
//                show_load:function(){
//                },
//                hide_load:function(time){
//                },
//                init_page:function(){
//                },
//                show_nav:function(){
//                },
//                hide_nav:function(){
//                },
//                add_nav:function(str){
//                },
//                alert:function(str){
//                    alert(str)
//                },
//                confirm:function(info,callback){
//                    confirm(info, callback);
//                },
//                open_image:function(str){
//                    alert(str)
//                }
//            }
//        }

        manager={
            init:function(){
                ff.hide_load(200)
                ff.init_page()
//                ff.show_nav()
            }
        }
    </script>

    <script type="text/javascript">
        //        var strategies = Vue.config.optionMergeStrategies
        //        strategies.myOption = strategies.methods

        menu = {{ menu | jsonify }}

        var org_height=$(window).height()
        $(function(){
            $(window).resize(function(){
                var delta = org_height - $(window).height()
                if(Math.abs(delta)  > 200){
                    $(".footer.nav").hide()
                }else{
                    $(".footer.nav").show()
                }

            })

        })

        ex.each(menu,function(act){
            if(act.url==location.pathname){
                $('title').html(act.label)
            }
        })

        $(function(){
//            $('.weui-tabbar.nav a').on('touchstart',function(){
//                $(this).addClass('fake-active')
//            })
//            $('.weui-tabbar.nav a').on('touchend',function(){
//                var self=this
//                setTimeout(function(){
//                    $(self).removeClass('fake-active')
//                },500)
//
//            })
//            $('.weui-tabbar.nav a').on('click',function(){
//                $(this).addClass('fake-active')
//
//            })
            setTimeout(function(){
                $('body').removeClass('start')
                $('body').addClass('ready')
            })



        })


    </script>

    {% block extra_head %}

    {% endblock %}
</head>
<body class="start">

<script>



$(function(){
    manager.init()
})




//    var history_state={crt_view:'init'}
//
//    function pushState(state){
//        state.call_iframe='popState'
//        parent.pushState(state)
//    }
//    function popState(state){
//        ex.assign(history_state,state)
//    }

//    pushState(history_state)


//    parent.iframe_full_screen(false,1)

    bus=new Vue()

//    in_wx_agent=false
//
//    title_bar=true
//    with_back=true
//    with_menu=true


//    ln_state={
//        crt_view:''
//    }
//    $(function(){
//        ln.history_handle({
//            init:ln_state,
//            handler:function(state){
//                ex.assign(ln_state,state)
//            }
//        })
//    })



    $(function(){

        setTimeout(function(){
            $('body').removeClass('start')
            $('body').addClass('ready')
        })

//        new Vue({
//            el:'#com-title',
//            data:{
//                title_bar:title_bar,
//                page_label:page_label,
//                with_back:with_back,
//                with_menu:with_menu,
//            },
//            computed:{
//                is_show_back:function(){
//                    if(this.with_back){
//                        return true
//                    }else{
//                        return false
//                    }
//                }
//            },
//            methods:{
//
//            }
//        })
    })


</script>
<style>
    body.start{
        opacity: 0;
    }
    body.ready{
        background-color: #fafafa;
        transition: all 0.2s ease;
    }


    .title-bar{
        width: 100vw;
        height: 3em;
        background-color: #323232;
        color: white;
    }
    .title-bar div{
        min-width: 3em;
        padding: 0.3em 0.6em;
    }
    /*.main.content{*/
    /*padding: 0.5em 0 4em 0;*/
    /*}*/

    .total-page{
        height: 100vh;
        width: 100vm;
    }
    .popup-overlay{z-index: 111 !important;}

    div.toolbar{
        height: auto;
    }
</style>

<div class="flex-v total-page">
    <!--<div id="com-title">-->
        <!--<title-bar v-if="title_bar" :title="page_label" :with_back="is_show_back" :with_menu="with_menu"></title-bar>-->
    <!--</div>-->


    <div id="main-content-wrap" class="flex-grow flex-v" style="overflow: auto;">

        {% block page_content %}

        {% endblock %}


    </div>
    <div>
        {% block tool_bar %}

        {% endblock %}
    </div>
</div>



<style type="text/css">

    .field .error{
        color: red;
    }
    [v-cloak] {
        display: none;
    }
    .nav.footer{
        position: static;
    }

    .scroll-wraper{
        position: absolute;
        top:0;
        left:0;
        bottom: 0;
        right:0;
    }


</style>


{% block extra_body %}
{% endblock %}

</body>

<script type="text/javascript" src="/static/lib/framework7/framework7.min.js"></script>
<link rel="stylesheet" href="/static/lib/framework7/framework7.ios.min.css">
<link rel="stylesheet" href="/static/lib/framework7/framework7.ios.colors.min.css">

<script>
    $(function(){
        f7_app = new Framework7({
            fastClicks:false,
        });
    })

    $(function(){
        Vue.nextTick(function(){
            material_wave_init()

        })

    })

</script>

<style>
    /*.material-design {*/
        /*position: relative;*/
    /*}*/
    /*.material-design canvas {*/
        /*opacity: 0.25;*/
        /*position: absolute;*/
        /*top: 0;*/
        /*left: 0;*/
    /*}*/

</style>
{% block extra_script %}
{% endblock %}

</html>
