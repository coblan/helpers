{% extends "f7/base.html" %}
{% load static %}
{% load jsonify %}


{% block page_content %}
<script src='{% static "js/ex_inputs.pack.js?t=" %}{{ stamp.ex_inputs_pack_js}}'></script>

{% include 'work/com_workindex.html' %}


<script type="text/javascript">


//    with_menu=false
    ex.each(heads,function(head){
        if(head.name=='work'){
            head.type='btn-dir'
        }
    })


    form_logic={
        el:'#there',
        data:{
//                menu:menu,
            crt_view:'main',
            page_label:page_label,
            is_shrink:true,

        },
        mixins:[field_fun],

        computed:{

        },

        methods:{
            after_sub:function(new_row){
                var self=this
                ff.back(function(last_win){
                    if(self.kw.row.pk){
                        var row = ex.findone(last_win.rows,{pk:new_row.pk})
                        ex.assign(row,new_row)
                        row.work=new_row._work_label
                    }else{ // 新建
                        last_win.location.reload()
                    }

                })
            },
            shrinked:function(heads){
                if(this.is_shrink){
                    return ex.sort_by_names(this.kw.heads,['work','finish_time','count','short'])
                }else{
                    return ex.sort_by_names(this.kw.heads,['work','finish_time','count','short','status'],true)
                }

            },
            expand:function(){
                this.is_shrink=false
//                    var self=this
//                    setTimeout(function(){
//                        self.$refs.scroller.refresh()
//                    },500)
            },


        }
    }


    $(function(){
        form =new Vue(form_logic)
    })
</script>



<div id="there" v-cloak style="overflow: auto">
    <div v-show="crt_view=='main'">

        <div class="form-pad">
            <field v-for="head in shrinked(kw.heads)" :name="head.name" :kw="kw"></field>
            <div v-if="is_shrink" @click="expand()" style="position: absolute;right:1em;padding: 0.3em;color: #3c8aff;">更多<i class="fa fa-angle-down" aria-hidden="true"></i></div>
        </div>


        <div v-btn-group>
            <a state="success" @click="submit()">确定</a>
        </div>


    </div>

</div>


{% endblock %}