{% extends "wx/tabgroup.html" %}
{% load static %}
{% block extra_head %}
<script src='{% static "js/ex_inputs.pack.js" %}'></script>
<script>

    bus=new Vue()
    department_url = "{% url 'organize.department' %}"
    row.depart_obj=row.depart_obj || {pk:null,name:'请选择部门'}

ex.each(heads,function(head){
    if(head.name=='depart'){
        head.type='department'
    }
})

depart_logic={
    data:function(){
        return {
            show_depart:false,
            department_url:department_url,
        }
    },
    mounted:function(){
        bus.$on('depart-btn-click',this.open_depart_win)
    },
    methods:{

        on_dirclick:function(department){
            row.depart_obj=department
            row.depart=department.pk
            this.show_depart=false
        },
        open_depart_win:function(){
            this.show_depart=true
            if(row.depart_obj.pk){
                this.$refs.catalog.dir_data(row.depart_obj)
            }
        }
    }
}

form_logic.mixins=[field_fun,depart_logic]

Vue.component('department',{
    props:['name','row','kw'],
    template:'<button style="margin-left: 1em;" type="button" class="btn btn-primary btn-xs" v-text="row.depart_obj.name" @click="on_click()">sss</button>',
    methods:{
        on_click:function(){
            bus.$emit('depart-btn-click')
        }
    }
})
</script>

<style>
    .department-win{
        width: 80vw;
        height: 70vh;
    }
    .department-win ul{
        padding: 0.5em 2em 3em 2em;
    }
</style>
{% endblock %}

{% block extra_body %}

<transition name="fade">
<modal @click.native="show_depart=false" :show="show_depart">
    <div @click.stop="" class="department-win">
        <com-catalog ref="catalog" :url="department_url" :root="{pk:null,name:'公司'}" @dirclick="on_dirclick($event)"
                     :editable="false" inline-template>

            <div class="com-catalog">
                <div class="flex">
                    <ol class="breadcrumb flex-grow">
                        <li ><a href="javacript:;" @click="dir_data(root)" v-text="root.name">root</a></li>
                        <li v-for="dir in parents" ><a href="javacript:;" v-text="dir.name" @click="dir_data(dir)" ></a></li>
                    </ol>
                    <slot name="head_end"></slot>
                </div>

                <div class="bd">
                    <ul>
                        <li v-for="dir in dirs" class="dir">

                            <span v-text="dir.name" class="clickable name" @click="dir_data(dir)"></span>
                            <button class="btn btn-default btn-xs" type="button" @click="$emit('dirclick',dir)">选择</button>
                            <!--<slot name="btn-panel" :selected="selected" :item="dir"></slot>-->
                        </li>
                    </ul>
                </div>
            </div>

        </com-catalog>
    </div>

</modal>
</transition>

{% endblock%}